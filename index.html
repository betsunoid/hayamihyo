<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å¹´åº¦ æ±ç”¨æ¼”ç®—æ—©è¦‹è¡¨</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        /* --- å…¨ä½“å…±é€š --- */
        body { font-family: sans-serif; margin: 0; padding: 0; background: #fff; color: #000; line-height: 1.1; }
        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

        /* å°åˆ·ã‚¿ã‚¤ãƒˆãƒ« */
        .print-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
        }

        /* æ“ä½œã‚¨ãƒªã‚¢ */
        .no-print-area { 
            padding: 12px; background: #f0f7ff; border-bottom: 2px solid #007bff;
            position: sticky; top: 0; z-index: 2000;
        }
        .controls { display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 8px; align-items: center; }
        select { padding: 10px; font-size: 18px; font-weight: bold; flex: 1; border-radius: 5px; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: #fff; font-size: 14px; }
        .btn-blue { background: #007bff; }
        .btn-green { background: #28a745; }
        
        /* ãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®š */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; min-width: 500px; border-collapse: collapse; border: 2px solid #000; table-layout: fixed; }
        th, td { border: 1px solid #000; text-align: right; padding: 10px 5px; font-weight: bold; font-size: 15px; }
        
        th, .group-header { 
            background-color: #000 !important; 
            color: #ffffff !important; 
        }

        .sticky-col { 
            position: sticky; left: 0; background: #fdfdfd !important; 
            z-index: 100; text-align: left; width: 110px; font-size: 13px; 
            box-shadow: 2px 0 5px rgba(0,0,0,0.1); word-break: break-all;
        }

        .z-on { background-color: #eeeeee !important; }
        .orange { color: #d35400 !important; }
        .green { color: #1e8449 !important; }

        /* --- å°åˆ·å°‚ç”¨è¨­å®š --- */
        @media print {
            @page { size: A4 portrait; margin: 5mm 6mm; }
            .no-print-area { display: none; }
            .print-title { font-size: 18px; margin: 5px 0 10px 0; }
            .table-wrapper { overflow: visible; }
            table { min-width: auto; width: 100%; border: 2.5px solid #000; }
            th, td { padding: 4px 3px; font-size: 10.6px; height: auto; }
            .sticky-col { position: static; background: transparent !important; width: 32%; font-size: 10.6px; box-shadow: none; }
            .group-header { padding: 5px 10px; font-size: 10.6px; }
            .z-on { background-color: #dddddd !important; }
        }
    </style>
</head>
<body>

<div class="no-print-area">
    <div class="controls">
        <div class="row">
            <select id="rankSelect" onchange="updateTable()"></select>
            <button class="btn btn-blue" onclick="window.print()">å°åˆ·ã™ã‚‹</button>
        </div>
        <div class="row">
            <input type="file" id="fileInput" accept="image/*,application/pdf" style="display:none;" onchange="handleFile(this)">
            <button class="btn btn-green" style="width:100%;" onclick="document.getElementById('fileInput').click()">ğŸ“· ç”»åƒãƒ»PDFã‹ã‚‰èª­ã¿è¾¼ã¿</button>
        </div>
        <div id="status" style="font-size:12px; color:#666;"></div>
    </div>
</div>

<div class="print-title" id="displayTitle">2025å¹´åº¦ ãƒ©ãƒ³ã‚¯S æ±ç”¨æ¼”ç®—æ—©è¦‹è¡¨</div>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th style="width: 110px;">é …ç›®å</th>
                <th>åŸºæœ¬</th>
                <th>å‡ºå¼µè²»</th>
                <th>å°è¨ˆ</th>
                <th>æ¶ˆè²»ç¨</th>
                <th>åˆè¨ˆ</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    const RANKS = ["H", "G", "F", "E", "D", "C", "B", "A", "S", "SS", "SSS"];
    const baseData = {
        "å®šæœŸUP": [6775, 7462, 7855, 8149, 8444, 8836, 9425, 9524, 9818, 10113, 10211],
        "å®šæœŸGP": [8444, 9327, 9818, 10211, 10505, 10996, 11684, 11880, 12273, 12567, 12764],
        "æ™®é€šUP": [7756, 8542, 9033, 9327, 9622, 10113, 10702, 10898, 11193, 11487, 11684],
        "æ™®é€šGP": [9425, 10407, 10996, 11389, 11684, 12273, 13058, 13255, 13647, 14040, 14236],
        "å­¦æ ¡UP": [4811, 4811, 4811, 4811, 5302, 5302, 5891, 5891, 5891, 5891, 5891],
        "å­¦æ ¡GP": [5793, 5793, 5793, 5793, 6578, 6578, 7265, 7265, 7265, 7265, 7265],
        "å­¦æ ¡CF": [0, 0, 0, 0, 7560, 7560, 7560, 8542, 8542, 8542, 8542],
        "å­¦æ ¡SW": [0, 0, 0, 0, 0, 0, 0, 8935, 8935, 8935, 8935]
    };

    const sel = document.getElementById('rankSelect');
    const displayTitle = document.getElementById('displayTitle');

    RANKS.forEach((r, idx) => {
        const opt = document.createElement('option');
        opt.value = idx; opt.textContent = "ãƒ©ãƒ³ã‚¯ " + r;
        if(r === "S") opt.selected = true;
        sel.appendChild(opt);
    });

    function updateTable() {
        const i = parseInt(sel.value);
        const currentRankName = RANKS[i];
        
        // ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã€Œæ±ç”¨ã€å…¥ã‚Šã§æ›´æ–°
        displayTitle.textContent = `2025å¹´åº¦ ãƒ©ãƒ³ã‚¯${currentRankName} æ±ç”¨æ¼”ç®—æ—©è¦‹è¡¨`;

        const conRate = 0.7658;
        const c21 = Math.ceil(21000 * conRate / 100) * 100;
        const c22 = Math.ceil(22000 * conRate / 100) * 100;

        const mainItems = [
            {n:"å®šæœŸUP", v:baseData.å®šæœŸUP[i]}, {n:"å®šæœŸGP", v:baseData.å®šæœŸGP[i]},
            {n:"æ™®é€šUP", v:baseData.æ™®é€šUP[i]}, {n:"æ™®é€šGP", v:baseData.æ™®é€šGP[i]},
            {n:"ã‚³ãƒ³ã‚µãƒ¼ãƒˆ21000", v:c21}, {n:"ã‚³ãƒ³ã‚µãƒ¼ãƒˆ22000", v:c22}
        ];

        let html = "";
        const travels = [{l:"3,000å††åœ°åŸŸ", v:2356}, {l:"3,500å††åœ°åŸŸ", v:2847}, {l:"4,000å††åœ°åŸŸ", v:3338}];

        travels.forEach(trv => {
            html += `<tr><td colspan="6" class="group-header">ã€å‡ºå¼µè²» ${trv.l}ã€‘</td></tr>`;
            mainItems.forEach((item, idx) => {
                const sub = item.v + trv.v;
                const tax = Math.floor(sub * 0.1);
                const zebra = (idx % 2 === 1) ? "z-on" : "";
                html += `<tr class="${zebra}"><td class="sticky-col">${item.n}</td><td>${item.v.toLocaleString()}</td><td>${trv.v.toLocaleString()}</td><td>${sub.toLocaleString()}</td><td>${tax.toLocaleString()}</td><td class="orange">${(sub+tax).toLocaleString()}</td></tr>`;
            });
        });

        html += `<tr><td colspan="6" class="group-header">ã€å‡ºå¼µè²»ãªã—ã€‘</td></tr>`;
        const freeItems = [
            {n:"å­¦æ ¡ UP", v:baseData.å­¦æ ¡UP[i]}, {n:"å­¦æ ¡ GP", v:baseData.å­¦æ ¡GP[i]},
            {n:"å­¦æ ¡ CF/S", v:baseData.å­¦æ ¡CF[i]}, {n:"å­¦æ ¡ SW/B", v:baseData.å­¦æ ¡SW[i]},
            ...mainItems,
            {n:"éŸ³æ•™å‚™å“UP", v:6382}, {n:"éŸ³æ•™å‚™å“GP", v:7855},
            {n:"ç´èª¿ UP", v:5891}, {n:"ç´èª¿ GP", v:8836},
            {n:"åº—é ­ åå¤å±‹UP", v:6382}, {n:"åº—é ­ åå¤å±‹GP", v:7953},
            {n:"åº—é ­ RPS UP", v:6382}, {n:"åº—é ­ RPS GP", v:8836}
        ].filter(x => x.v > 0);

        freeItems.forEach((item, idx) => {
            const tax = Math.floor(item.v * 0.1);
            const zebra = (idx % 2 === 1) ? "z-on" : "";
            html += `<tr class="${zebra}"><td class="sticky-col">${item.n}</td><td>${item.v.toLocaleString()}</td><td>0</td><td>${item.v.toLocaleString()}</td><td>${tax.toLocaleString()}</td><td class="green">${(item.v+tax).toLocaleString()}</td></tr>`;
        });
        document.getElementById('tableBody').innerHTML = html;
    }

    async function handleFile(input) {
        const file = input.files[0];
        if(!file) return;
        const status = document.getElementById('status');
        status.textContent = "è§£æä¸­...";
        try {
            const { data: { text } } = await Tesseract.recognize(file, 'jpn');
            const foundRank = RANKS.find(r => new RegExp(`ãƒ©ãƒ³ã‚¯\\s*${r}|Rank\\s*${r}|^${r}$`, 'i').test(text));
            if (foundRank) {
                sel.value = RANKS.indexOf(foundRank);
                updateTable();
                status.textContent = `é©ç”¨: ãƒ©ãƒ³ã‚¯ ${foundRank}`;
            } else { status.textContent = "è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"; }
        } catch (e) { status.textContent = "è§£æã‚¨ãƒ©ãƒ¼"; }
    }

    updateTable();
</script>
</body>
</html>
